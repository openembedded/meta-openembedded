From 81860b9a56d83f429824aa0073c2152b49f9d332 Mon Sep 17 00:00:00 2001
From: Jacob Boerema <jgboerema@gmail.com>
Date: Sun, 5 Jun 2022 15:38:24 -0400
Subject: [PATCH] app: fix #8230 crash in gimp_layer_invalidate_boundary when
 channel is NULL

gimp_channel_is_empty returns FALSE if channel is NULL. This causes
gimp_layer_invalidate_boundary to crash if the mask channel is NULL.

With a NULL channel gimp_channel_is_empty should return TRUE, just like
the similar gimp_image_is_empty does, because returning FALSE here
suggests we have a non empty channel.

(cherry picked from commit 22af0bcfe67c1c86381f33975ca7fdbde6b36b39)

CVE: CVE-2022-32990
Upstream-Status: Backport [https://gitlab.gnome.org/GNOME/gimp/-/commit/744959433647bdefcdf00b3f0d575f6812cd0d6d]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 app/core/gimpchannel.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/core/gimpchannel.c b/app/core/gimpchannel.c
index a9b7546..784551a 100644
--- a/app/core/gimpchannel.c
+++ b/app/core/gimpchannel.c
@@ -1824,7 +1824,7 @@ gimp_channel_boundary (GimpChannel         *channel,
 gboolean
 gimp_channel_is_empty (GimpChannel *channel)
 {
-  g_return_val_if_fail (GIMP_IS_CHANNEL (channel), FALSE);
+  g_return_val_if_fail (GIMP_IS_CHANNEL (channel), TRUE);
 
   return GIMP_CHANNEL_GET_CLASS (channel)->is_empty (channel);
 }
