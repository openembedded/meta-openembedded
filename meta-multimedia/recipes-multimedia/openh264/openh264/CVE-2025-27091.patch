From 4e82ae10b594d87da2a7884c2de850857931c78f Mon Sep 17 00:00:00 2001
From: BenzhengZhang <140143892+BenzhengZhang@users.noreply.github.com>
Date: Thu, 19 Dec 2024 17:12:42 +0800
Subject: [PATCH] Potential bug fix (#3818)

CVE: CVE-2025-27091
Upstream-Status: Backport [https://github.com/cisco/openh264/commit/63db555e30986e3a5f07871368dc90ae78c27449]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 codec/decoder/core/src/decoder.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/codec/decoder/core/src/decoder.cpp b/codec/decoder/core/src/decoder.cpp
index 3b38032a..b971f12f 100644
--- a/codec/decoder/core/src/decoder.cpp
+++ b/codec/decoder/core/src/decoder.cpp
@@ -844,6 +844,10 @@ int32_t WelsDecodeBs (PWelsDecoderContext pCtx, const uint8_t* kpBsBuf, const in
             return pCtx->iErrorCode;
           }
 
+          if (pCtx->iErrorCode != ERR_NONE && !(pCtx->iErrorCode & dsDataErrorConcealed)) {
+              return pCtx->iErrorCode;
+          }
+
           pDstNal += (iDstIdx + 4); //init, increase 4 reserved zero bytes, used to store the next NAL
           if ((iSrcLength - iSrcConsumed + 4) > (pRawData->pEnd - pDstNal)) {
             pDstNal = pRawData->pCurPos = pRawData->pHead;
