From 09672b2fe25ca0ca6537412eb835209b6c7c791b Mon Sep 17 00:00:00 2001
From: BenzhengZhang <140143892+BenzhengZhang@users.noreply.github.com>
Date: Thu, 19 Dec 2024 17:12:42 +0800
Subject: [PATCH] Potential bug fix (#3818)

CVE: CVE-2025-27091
Upstream-Status: Backport [https://github.com/cisco/openh264/commit/63db555e30986e3a5f07871368dc90ae78c27449]
(cherry picked from commit 63db555e30986e3a5f07871368dc90ae78c27449)
Signed-off-by: Ankur Tyagi <ankur.tyagi85@gmail.com>
---
 codec/decoder/core/src/decoder.cpp | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/codec/decoder/core/src/decoder.cpp b/codec/decoder/core/src/decoder.cpp
index dba6711b..c639cf7c 100644
--- a/codec/decoder/core/src/decoder.cpp
+++ b/codec/decoder/core/src/decoder.cpp
@@ -848,6 +848,10 @@ int32_t WelsDecodeBs (PWelsDecoderContext pCtx, const uint8_t* kpBsBuf, const in
             return pCtx->iErrorCode;
           }
 
+          if (pCtx->iErrorCode != ERR_NONE && !(pCtx->iErrorCode & dsDataErrorConcealed)) {
+              return pCtx->iErrorCode;
+          }
+
           pDstNal += (iDstIdx + 4); //init, increase 4 reserved zero bytes, used to store the next NAL
           if ((iSrcLength - iSrcConsumed + 4) > (pRawData->pEnd - pDstNal)) {
             pDstNal = pRawData->pCurPos = pRawData->pHead;
