From 68c712b401538abc3028ecc5071fa787f87afa7f Mon Sep 17 00:00:00 2001
From: Ali Raza <elirazamumtaz@gmail.com>
Date: Thu, 29 Feb 2024 11:36:25 +0500
Subject: [PATCH] buffer overflow patched (#251)

Thank you for the PR

CVE: CVE-2024-22857
Upstream-Status: Backport [https://github.com/HardySimpson/zlog/commit/c47f781a9f1e9604f5201e27d046d925d0d48ac4]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 src/rule.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/rule.c b/src/rule.c
index ae3d74f..38d3fdc 100644
--- a/src/rule.c
+++ b/src/rule.c
@@ -866,8 +866,10 @@ zlog_rule_t *zlog_rule_new(char *line,
 		}
 		break;
 	case '$' :
-		sscanf(file_path + 1, "%s", a_rule->record_name);
-			
+		// read only MAXLEN_PATH characters from the file_path + 1
+		strncpy(a_rule->record_name, file_path + 1, MAXLEN_PATH);
+		a_rule->record_name[MAXLEN_PATH] = '\0';
+		
 		if (file_limit) {  /* record path exists */
 			p = strchr(file_limit, '"');
 			if (!p) {
