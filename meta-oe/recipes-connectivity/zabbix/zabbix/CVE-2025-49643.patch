From 6677023e3d48faa83d011c0d9ec241c9e617ed78 Mon Sep 17 00:00:00 2001
From: Ginta Berzina <ginta.berzina@zabbix.com>
Date: Mon, 1 Sep 2025 14:10:12 +0300
Subject: [PATCH] ..F....... [DEV-4466] fixed resource usage for image resize

CVE: CVE-2025-49643
Upstream-Status: Backport [https://github.com/zabbix/zabbix/commit/aeada86d3c8231e1e173c6a7ac19ea60bf899b86]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 ui/imgstore.php | 8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

diff --git a/ui/imgstore.php b/ui/imgstore.php
index 125b3c3..04663e8 100644
--- a/ui/imgstore.php
+++ b/ui/imgstore.php
@@ -34,8 +34,8 @@ $fields = [
 	'css' =>			[T_ZBX_INT, O_OPT, P_SYS, null,				null],
 	'imageid' =>		[T_ZBX_STR, O_OPT, P_SYS, null,				null],
 	'iconid' =>			[T_ZBX_INT, O_OPT, P_SYS, DB_ID,				null],
-	'width' =>			[T_ZBX_INT, O_OPT, P_SYS, BETWEEN(1, 2000),	null],
-	'height' =>			[T_ZBX_INT, O_OPT, P_SYS, BETWEEN(1, 2000),	null],
+	'width' =>			[T_ZBX_INT, O_OPT, P_SYS, BETWEEN(1, 200),	null],
+	'height' =>			[T_ZBX_INT, O_OPT, P_SYS, BETWEEN(1, 200),	null],
 	'unavailable' =>	[T_ZBX_INT, O_OPT, null, IN([0, 1]),		null]
 ];
 check_fields($fields);
@@ -58,10 +58,6 @@ if (isset($_REQUEST['css'])) {
 	foreach ($images as $image) {
 		$image['image'] = base64_decode($image['image']);
 		$ico = imagecreatefromstring($image['image']);
-
-		if ($resize) {
-			$ico = imageThumb($ico, $width, $height);
-		}
 		$w = imagesx($ico);
 		$h = imagesy($ico);
 
