#!/bin/sh

# This script runs tests taken from the github CI for the Double-Conversion library.
# For more information, please see: https://github.com/google/double-conversion/blob/master/.github/workflows/ci.yml#L60

# Count the number of failed tests
NUM_FAILS=0

# Run all tests using ctest
ctest -V

# VCount the number of failed tests by checking the LastTest.log file generated by ctest
NUM_FAILS=$(grep -c "Failed" Testing/Temporary/LastTest.log)

# Run the tests directly as well, just in case we forgot to add it to ctest
test/cctest/cctest
if [ $? -ne 0 ]; then
    # If the test failed, increment the number of failed tests
    NUM_FAILS=$(expr $NUM_FAILS + 1)
fi

# Return the number of failed tests
exit $NUM_FAILS
