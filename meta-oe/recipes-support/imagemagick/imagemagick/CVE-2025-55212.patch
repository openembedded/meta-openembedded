From 3cc6cf85fbe2d147c7b3d48e53f4e9f081448ae8 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sun, 17 Aug 2025 14:33:44 -0400
Subject: [PATCH] 
 https://github.com/ImageMagick/ImageMagick/security/advisories/GHSA-fh55-q5pj-pxgw

CVE: CVE-2025-55212
Upstream-Status: Backport [https://github.com/ImageMagick/ImageMagick/commit/5f0bcf986b8b5e90567750d31a37af502b73f2af]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 MagickCore/resize.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/MagickCore/resize.c b/MagickCore/resize.c
index ea6e535f4..298662f8a 100644
--- a/MagickCore/resize.c
+++ b/MagickCore/resize.c
@@ -4624,8 +4624,9 @@ MagickExport Image *ThumbnailImage(const Image *image,const size_t columns,
         x_factor,
         y_factor;
 
-      x_factor=(ssize_t) image->columns/(ssize_t) columns;
-      y_factor=(ssize_t) image->rows/(ssize_t) rows;
+      x_factor=(ssize_t) (image->columns*PerceptibleReciprocal((double) 
+        columns));
+      y_factor=(ssize_t) (image->rows*PerceptibleReciprocal((double) rows));
       if ((x_factor > 4) && (y_factor > 4))
         {
           thumbnail_image=SampleImage(clone_image,4*columns,4*rows,exception);
