From ca3654ebf7a439dc736f56f083c9aa98e4464b7f Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sat, 26 Mar 2022 09:26:57 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/4988
CVE: CVE-2022-28463
Upstream-Status: Backport [https://github.com/ImageMagick/ImageMagick/commit/ca3654ebf7a439dc736f56f083c9aa98e4464b7f]
Signed-off-by: Virendra Thakur <thakur.virendra1810@gmail.com>

---
 coders/cin.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/cin.c b/coders/cin.c
index e266e7f3c56..23fc17e0890 100644
--- a/coders/cin.c
+++ b/coders/cin.c
@@ -451,6 +451,8 @@ static Image *ReadCINImage(const ImageInfo *image_info,ExceptionInfo *exception)
   image->endian=(magick[0] == 0x80) && (magick[1] == 0x2a) &&
     (magick[2] == 0x5f) && (magick[3] == 0xd7) ? MSBEndian : LSBEndian;
   cin.file.image_offset=ReadBlobLong(image);
+  if (cin.file.image_offset < 712)
+    ThrowReaderException(CorruptImageError,"ImproperImageHeader");
   offset+=4;
   cin.file.generic_length=ReadBlobLong(image);
   offset+=4;

