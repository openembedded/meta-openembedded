From 94ca20e5aed5d8730e045bb945fa3485b28a7981 Mon Sep 17 00:00:00 2001
From: Gyorgy Sarvari <skandigraun@gmail.com>
Date: Tue, 6 Jan 2026 20:52:25 +0000
Subject: [PATCH] ITS#10421 mdb_load: check for malicious input

From: Howard Chu <hyc@openldap.org>

CVE: CVE-2026-22185
Upstream-Status: Backport [https://github.com/LMDB/lmdb/commit/8e1fda85532a3c74276df38a42d234dcdfa1e40d]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 libraries/liblmdb/mdb_load.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/libraries/liblmdb/mdb_load.c b/libraries/liblmdb/mdb_load.c
index d2a3cec..7eccf40 100644
--- a/libraries/liblmdb/mdb_load.c
+++ b/libraries/liblmdb/mdb_load.c
@@ -208,6 +208,12 @@ badend:
 
 	c1 = buf->mv_data;
 	len = strlen((char *)c1);
+	if (!len) {
+		/* This can only happen with an intentionally invalid input
+		 * with a NUL byte after the leading SPACE
+		 */
+		goto badend;
+	}
 	l2 = len;
 
 	/* Is buffer too short? */
