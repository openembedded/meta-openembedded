From 570c908c496b420562ed7142b898811cc8c70d3a Mon Sep 17 00:00:00 2001
From: Jackson <jacksonj2@kpit.com>
Date: Mon, 12 Jan 2026 08:39:56 +0530
Subject: [PATCH] CVE-2025-9384: Bug #894 stop on --portmap syntax error

src/tcprewrite -r 1:2 -i ping.pcap -c ping.cache -o out.pcap
src/tcprewrite -r 1-:2 -i ping.pcap -c ping.cache -o out.pcap

Fatal Error in ../../src/tcprewrite.c:main() line 86:
Unable to parse args: From ../../../src/tcpedit/parse_args.c:tcpedit_post_args() line 189:
Unable to parse --portmap=1-:2

CVE: CVE-2025-9384

Upstream-Status: Backport [https://github.com/appneta/tcpreplay/pull/946/commits/f6e6ee460ad9fe01e24a1579166b3f7a8c2158a7]
Comment: Patch refreshed

Signed-off-by: Jackson <jacksonj2@kpit.com>
---
 src/tcpedit/portmap.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/tcpedit/portmap.c b/src/tcpedit/portmap.c
index 5fe1779..1e54728 100644
--- a/src/tcpedit/portmap.c
+++ b/src/tcpedit/portmap.c
@@ -104,7 +104,7 @@ ports2PORT(char *ports)
         from_begin = strtok_r(from_s, "-", &token2);
         from_end = strtok_r(NULL, "-", &token2);
         long from_b = strtol(from_begin, &badchar, 10);
-        if (strlen(badchar) != 0) {
+        if (!from_begin || !from_end || strlen(badchar) != 0) {
             free(portmap);
             return NULL;
         }
-- 
2.34.1

