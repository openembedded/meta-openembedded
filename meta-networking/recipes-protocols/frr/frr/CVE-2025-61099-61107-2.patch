From d9ed123b814dad7cf4b069de5601c9f279596191 Mon Sep 17 00:00:00 2001
From: Gyorgy Sarvari <skandigraun@gmail.com>
Date: Tue, 6 Jan 2026 15:32:32 +0100
Subject: [PATCH] ospfd: skip subsequent tlvs after invalid length

From: Louis Scalbert <louis.scalbert@6wind.com>

Do not attempt to read subsequent TLVs after an TLV invalid length is
detected.

Signed-off-by: Louis Scalbert <louis.scalbert@6wind.com>

CVE: CVE-2025-61099 CVE-2025-61100 CVE-2025-61101 CVE-2025-61102 CVE-2025-61103 CVE-2025-61104 CVE-2025-61105 CVE-2025-61106 CVE-2025-61107
Upstream-Status: Backport [https://github.com/FRRouting/frr/commit/33dfc7e7be1ac8b66abbf47c30a709215fbc1926]
Signed-off-by: Gyorgy Sarvari <skandigraun@gmail.com>
---
 ospfd/ospf_ext.c | 6 +++---
 ospfd/ospf_ri.c  | 6 +++---
 ospfd/ospf_te.c  | 6 +++---
 3 files changed, 9 insertions(+), 9 deletions(-)

diff --git a/ospfd/ospf_ext.c b/ospfd/ospf_ext.c
index 8ca0df3200..62b0020148 100644
--- a/ospfd/ospf_ext.c
+++ b/ospfd/ospf_ext.c
@@ -1710,11 +1710,11 @@ static void ospf_ext_lsa_schedule(struct ext_itf *exti, enum lsa_opcode op)
 	do {                                                                   \
 		if (ntohs(tlvh->length) != size) {                             \
 			if (vty != NULL)                         \
-				vty_out(vty, "  Wrong %s TLV size: %d(%d). Abort!\n",  \
+				vty_out(vty, "  Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!\n",  \
 					msg, ntohs(tlvh->length), size);               \
 			else                                              \
-				zlog_debug("    Wrong %s TLV size: %d(%d). Abort!", msg, ntohs(tlvh->length), size);    \
-			return size + TLV_HDR_SIZE;                            \
+				zlog_debug("    Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!", msg, ntohs(tlvh->length), size);    \
+			return OSPF_MAX_LSA_SIZE + 1;                            \
 		}                                                              \
 	} while (0)
 
diff --git a/ospfd/ospf_ri.c b/ospfd/ospf_ri.c
index 76e6efeb83..7934b25451 100644
--- a/ospfd/ospf_ri.c
+++ b/ospfd/ospf_ri.c
@@ -1208,12 +1208,12 @@ static int ospf_router_info_lsa_update(struct ospf_lsa *lsa)
 	do {                                                                   \
 		if (ntohs(tlvh->length) > size) {                              \
 			if (vty != NULL)                                       \
-				vty_out(vty, "  Wrong %s TLV size: %d(%d)\n",  \
+				vty_out(vty, "  Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!\n",  \
 					msg, ntohs(tlvh->length), size);       \
 			else                                                   \
-				zlog_debug("    Wrong %s TLV size: %d(%d)",    \
+				zlog_debug("    Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!",    \
 					   msg, ntohs(tlvh->length), size);    \
-			return size + TLV_HDR_SIZE;                            \
+			return OSPF_MAX_LSA_SIZE + 1;                            \
 		}                                                              \
 	} while (0)
 
diff --git a/ospfd/ospf_te.c b/ospfd/ospf_te.c
index d187485b9f..850a7039f1 100644
--- a/ospfd/ospf_te.c
+++ b/ospfd/ospf_te.c
@@ -3161,12 +3161,12 @@ static void ospf_te_init_ted(struct ls_ted *ted, struct ospf *ospf)
 	do {                                                                   \
 		if (ntohs(tlvh->length) > size) {                              \
 			if (vty != NULL)                                       \
-				vty_out(vty, "  Wrong %s TLV size: %d(%d)\n",  \
+				vty_out(vty, "  Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!\n",  \
 					msg, ntohs(tlvh->length), size);       \
 			else                                                   \
-				zlog_debug("    Wrong %s TLV size: %d(%d)",    \
+				zlog_debug("    Wrong %s TLV size: %d(expected %d). Skip subsequent TLVs!",    \
 					   msg, ntohs(tlvh->length), size);    \
-			return size + TLV_HDR_SIZE;                            \
+			return OSPF_MAX_LSA_SIZE + 1;                            \
 		}                                                              \
 	} while (0)
 
